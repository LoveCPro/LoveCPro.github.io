---
layout: post
title:  "select poll epoll区别整理"
date:   2021-12-13T14:25:52-05:00
header-img: img/post-bg-cook.jpg
author: Dandan
catalog: true
tags:
    -  C程序技术
---


# select poll epoll 区别
不管是面试还是平时开发工作都会遇到select poll epoll之间区别的问题，今天大概给总结一下：

| 特性                                 | select                           | poll                             | epoll                             |
|--------------------------------------|----------------------------------|----------------------------------|----------------------------------|
| 底层数据结构                         | 数组存储文件描述符               | 链表存储文件描述符              | 红黑树存储文件描述符方式 、双链表存储就绪的文件描述符                        |          |                       |
| 如何从fd数据中获取就绪的fd   | 遍历fd_set                       | 遍历链表                         | 回调                             |
| 时间复杂度      |获得就绪的文件描述符需要遍历fd数组 O(n)                             | 获得就绪的文件描述符需要遍历fd链表O(n)                             | 当有就绪事件时，系统注册的回调函数就会被调用，将就绪的fd放到链表中 O(1)                             
                          
| fd数据拷贝                     | 每次调用select， 需要将fd数据从用户空间拷贝到内核空间     | 每次调用poll需要将fd数据从用户空间拷贝到内核空间     | 使用内存映射mmap,不需要从用户空间频繁拷贝fd数据到内和空间，epoll_ctl时拷贝进内核，之后每次epoll_wait不需拷贝         |
| 内存使用                             | 较高                             | 较高                             | 较低                             |
| 最大连接数限制                       | 有限制，一般为1024               | 无限制                           | 无限制 



# 应用场景
    a. 连接数较少并且都很活跃,用select和poll效率更高
    b. 连接数较多并且都不很活跃,使用epoll效率更高

# select 缺点：
1.性能开销大：
  1. 调用 select 时会陷入内核，这时需要将参数中的 fd_set 从用户空间拷贝到内核空间
  2. 内核需要遍历传递进来的所有 fd_set 的每一位，不管它们是否就绪
2.文件描述符个数太少

# poll
1.和select几乎没有区别，用户态数组方式传递文件描述符，到了 内核转变成链表存储， 无文件描述符限制， 从性能开销上 和select差别不大


# epoll
1.避免了 开销大的问题
1.使用红黑树存储文件描述符集合    ---
2使用队列存储就绪的文件描述符

适用场景：
1.连接数很多 且  是 不活跃的连接时，epoll 效率比其他的要高
2.当连接数较少  且活跃， 使用 select 或者 poll
